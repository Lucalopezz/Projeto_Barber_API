generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                  String        @id
  name                String
  email               String        @unique
  password            String
  role                Role
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  barberShopId        String?
  appointmentsCreated Appointment[] @relation("ClientAppointments")
  ownedBarberShop     BarberShop?   @relation("Owner")
  barberShop          BarberShop?   @relation("Barbers", fields: [barberShopId], references: [id], onDelete: Cascade)
}

model BarberShop {
  id           String        @id
  name         String
  address      String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  ownerId      String?       @unique
  appointments Appointment[]
  owner        User?         @relation("Owner", fields: [ownerId], references: [id], onDelete: Cascade)
  services     Service[]
  barbers      User[]        @relation("Barbers")
}

model Service {
  id           String        @id
  name         String
  price        Float
  duration     Int
  description  String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  barberShopId String
  appointments Appointment[]
  barberShop   BarberShop    @relation(fields: [barberShopId], references: [id], onDelete: Cascade)
}

model Appointment {
  id           String            @id
  date         DateTime
  status       AppointmentStatus @default(scheduled)
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  clientId     String
  serviceId    String
  barberShopId String
  barberShop   BarberShop        @relation(fields: [barberShopId], references: [id], onDelete: Cascade)
  client       User              @relation("ClientAppointments", fields: [clientId], references: [id], onDelete: Cascade)
  service      Service           @relation(fields: [serviceId], references: [id], onDelete: Cascade)
}

enum Role {
  barber
  client
}

enum AppointmentStatus {
  scheduled
  completed
  cancelled
}
